<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>resize</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      padding: 0;
    }

    .divider {
      background-color: black;
      cursor: ew-resize;
      height: 100%;
      width: 2px;
      z-index: 1000;
      cursor: ew-resize;
      height: 100px;
      width: 2px;
      /* position: absolute; */
    }

    .segment {
      min-width: 1px;
    }
  </style>
</head>

<body class="font-sans w-full">
  <div style="border: black solid 1px; display: flex; position: relative" id="bar-parent">
    <!-- <div style="
          background: yellow;
          width: 33.3333333333%;
          display: flex;
          height: 100px;
        ">
      Left
    </div>
    <div class="resizer"></div>
    <div style="
          background: pink;
          width: 33.33333333%;
          display: flex;
          height: 100px;
        ">
      Right
    </div>
    <div class="resizer"></div>
    <div style="
          background: rgb(109, 220, 240);
          width: 33.333333333%;
          display: flex;
          height: 100px;
        ">
      RightRight
    </div> -->
  </div>

  <script>
    class BarMaker {
      constructor(initialState) {
        this.selectedDivider = null
        this.leftWidth = 0
        this.rightWidth = 0
        this.mouseDownHandler = this.mouseDownHandler.bind(this)
        this.mouseMoveHandler = this.mouseMoveHandler.bind(this)
        this.mouseUpHandler = this.mouseUpHandler.bind(this)
        this.initBar(initialState);
      }

      initBar(initialState = {}) {
        // console.log('init', this.mouseUpHandler, this.mouseMoveHandler)
        if (!initialState.segments || initialState.segements.length === 0) {
          initialState.segments = [
            {
              backgroundColor: "yellow",
              width: (1 / 3) * 100,
              display: "flex",
              height: "100px",
              innerText: "left",
              left: null,
              right: null
            },
            {
              backgroundColor: "pink",
              width: (1 / 3) * 100,
              display: "flex",
              height: "100px",
              innerText: "middle",
              left: null,
              right: null
            },
            {
              backgroundColor: "rgb(109, 220, 240)",
              width: (1 / 3) * 100,
              display: "flex",
              height: "100px",
              innerText: "right",
              left: null,
              right: null
            }
          ]
        }
        if (!initialState.parentID) {
          initialState.parentID = "bar-parent"
        }
        this.state = initialState

        this.parent = document.querySelector(`#${this.state.parentID}`)
        for (let i = 0; i < this.state.segments.length; i++) {
          const segmentDiv = document.createElement("div")
          const { backgroundColor, width, display, height, innerText } = this.state.segments[i]
          segmentDiv.style.backgroundColor = backgroundColor
          segmentDiv.style.width = `${width}%`
          segmentDiv.style.height = height
          segmentDiv.style.display = display
          segmentDiv.innerText = innerText
          this.parent.appendChild(segmentDiv)
          this.state.segments[i].element = segmentDiv

          // If not the last segment, create divider, attach it as segment.right, make 
          // divider.left a reference to segment in state
          if (i !== this.state.segments.length - 1) {
            const dividerDiv = document.createElement('div')
            dividerDiv.style.backgroundColor = "black"
            // dividerDiv.style.height = "100%"
            dividerDiv.style.width = "2px"
            dividerDiv.style.cursor = "ew-resize";
            dividerDiv.left = this.state.segments[i]
            this.state.segments[i].right = dividerDiv
            segmentDiv.insertAdjacentElement("afterend", dividerDiv)
            dividerDiv.addEventListener("mousedown", this.mouseDownHandler)
          }

          // If not first segment, reference the right divider of last segment,
          // attach is segment.left, and reference current segment as divider.right
          if (i !== 0) {
            const dividerDiv = this.state.segments[i - 1].right
            this.state.segments[i].left = dividerDiv
            dividerDiv.right = this.state.segments[i]
          }
          console.log('this.state.segments[i]', this.state.segments[i])
        }
      }

      mouseDownHandler(e) {
        this.selectedDivider = e.target;
        // leftSide = resizer.previousElementSibling;
        // rightSide = resizer.nextElementSibling;
        // Get the current mouse position
        this.x = e.clientX;
        this.y = e.clientY;
        this.leftWidth = this.selectedDivider.left.element.getBoundingClientRect().width;
        this.rightWidth = this.selectedDivider.right.element.getBoundingClientRect().width;

        // this.selectedDivider.style.cursor = "col-resize";
        document.body.style.cursor = "ew-resize";

        this.selectedDivider.left.element.style.userSelect = "none";
        this.selectedDivider.left.element.style.pointerEvents = "none";

        this.selectedDivider.right.element.style.userSelect = "none";
        this.selectedDivider.right.element.style.pointerEvents = "none";

        // console.log("mousedown sides", rightSide, leftSide);
        // console.log("mousedown target", e.target);

        // Attach the listeners to `document`
        document.addEventListener("mousemove", this.mouseMoveHandler);
        document.addEventListener("mouseup", this.mouseUpHandler);
        console.log('mouseDown', this.mouseUpHandler)
      };

      mouseMoveHandler(e) {
        console.log('this.selectedDivider.left before', this.selectedDivider.left.width, this.parent.getBoundingClientRect().width)

        // How far the mouse has been moved
        const dx = e.clientX - this.x;
        // console.log('mouse moved', dx)
        console.log('dxxx', e.clientX, this.x, dx)
        const newLeftWidth =
          ((this.leftWidth + dx) * 100) /
          this.parent.getBoundingClientRect().width;
        this.selectedDivider.left.element.style.width = `${newLeftWidth}%`;
        this.selectedDivider.left.width = newLeftWidth
        console.log('this.selectedDivider.left after', newLeftWidth, this.selectedDivider.left.width, this.parent.getBoundingClientRect().width)

        const newRightWidth =
          ((this.rightWidth - dx + 2) * 100) / // +2 because of width of dividers
          this.parent.getBoundingClientRect().width;
        this.selectedDivider.right.element.style.width = `${newRightWidth}%`;
        this.selectedDivider.right.width = newRightWidth
      }

      mouseUpHandler() {
        console.log('mouse up')
        // this.selectedDivider.style.removeProperty("cursor");
        document.body.style.removeProperty("cursor");

        // this.selectedDivider.left.element.style.removeProperty("user-select");
        // this.selectedDivider.left.element.style.removeProperty("pointer-events");

        // this.selectedDivider.right.element.style.removeProperty("user-select");
        // this.selectedDivider.right.element.style.removeProperty("pointer-events");

        //old
        //  resizer.style.removeProperty("cursor");
        // document.body.style.removeProperty("cursor");

        // leftSide.style.removeProperty("user-select");
        // leftSide.style.removeProperty("pointer-events");

        // rightSide.style.removeProperty("user-select");
        // rightSide.style.removeProperty("pointer-events");

        // Remove the handlers of `mousemove` and `mouseup`
        document.removeEventListener("mousemove", this.mouseMoveHandler);
        document.removeEventListener("mouseup", this.mouseUpHandler);

        this.selectedDivider = null
      };

      // if (rightSide.getBoundingClientRect().width <= 5) {
      //   // initialwidth && (initialwidth = leftWidth )
      //   // console.log("*******************");

      //   const rightOfRight =
      //     rightSide.nextElementSibling.nextElementSibling;
      //   const rightRightWidth = rightOfRight.getBoundingClientRect().width;

      //   const newRightRightWidth =
      //     ((rightRightWidth - dx + 2) * 100) / // +2 because of width of resizers
      //     resizer.parentNode.getBoundingClientRect().width;
      //   console.log("rightRightWidth, dx", rightRightWidth, dx);
      //   rightOfRight.style.width = `${newRightRightWidth}%`;
      // }

      initListeners() {
        // Query the element
        let resizer = null;
        let leftSide = null;
        let rightSide = null;

        // The current position of mouse
        let x = 0;
        let y = 0;
        let leftWidth = 0;
        let rightWidth = 0;
        let initialwidth = null;

        // Handle the mousedown event
        // that's triggered when user drags the resizer
        // const mouseDownHandler = function (e) {
        //   resizer = e.target;
        //   leftSide = resizer.previousElementSibling;
        //   rightSide = resizer.nextElementSibling;
        //   // Get the current mouse position
        //   x = e.clientX;
        //   y = e.clientY;
        //   leftWidth = leftSide.getBoundingClientRect().width;
        //   rightWidth = rightSide.getBoundingClientRect().width;

        //   // console.log("mousedown sides", rightSide, leftSide);
        //   // console.log("mousedown target", e.target);

        //   // Attach the listeners to `document`
        //   document.addEventListener("mousemove", mouseMoveHandler);
        //   document.addEventListener("mouseup", mouseUpHandler);
        // };

        // const mouseMoveHandler = function (e) {
        //   // How far the mouse has been moved
        //   const dx = e.clientX - x;
        //   // console.log('dxxx', e.clientX, x, dx)
        //   const newLeftWidth =
        //     ((leftWidth + dx) * 100) /
        //     resizer.parentNode.getBoundingClientRect().width;
        //   leftSide.style.width = `${newLeftWidth}%`;

        //   const newRightWidth =
        //     ((rightWidth - dx + 2) * 100) / // +2 because of width of resizers
        //     resizer.parentNode.getBoundingClientRect().width;
        //   rightSide.style.width = `${newRightWidth}%`;

        //   if (rightSide.getBoundingClientRect().width <= 5) {
        //     // initialwidth && (initialwidth = leftWidth )
        //     // console.log("*******************");

        //     const rightOfRight =
        //       rightSide.nextElementSibling.nextElementSibling;
        //     const rightRightWidth = rightOfRight.getBoundingClientRect().width;

        //     const newRightRightWidth =
        //       ((rightRightWidth - dx + 2) * 100) / // +2 because of width of resizers
        //       resizer.parentNode.getBoundingClientRect().width;
        //     console.log("rightRightWidth, dx", rightRightWidth, dx);
        //     rightOfRight.style.width = `${newRightRightWidth}%`;
        //   }

        // console.log(
        //   "mousemove new widths",
        //   // leftSide.style.width,
        //   rightSide.getBoundingClientRect().width
        // );

        // resizer.style.cursor = "col-resize";
        // document.body.style.cursor = "col-resize";

        // leftSide.style.userSelect = "none";
        // leftSide.style.pointerEvents = "none";

        // rightSide.style.userSelect = "none";
        // rightSide.style.pointerEvents = "none";

        // console.log("mousedown", x, y, leftWidth);
        // };

        // const mouseUpHandler = function () {
        //   resizer.style.removeProperty("cursor");
        //   document.body.style.removeProperty("cursor");

        //   leftSide.style.removeProperty("user-select");
        //   leftSide.style.removeProperty("pointer-events");

        //   rightSide.style.removeProperty("user-select");
        //   rightSide.style.removeProperty("pointer-events");

        //   // Remove the handlers of `mousemove` and `mouseup`
        //   document.removeEventListener("mousemove", mouseMoveHandler);
        //   document.removeEventListener("mouseup", mouseUpHandler);
        // };

        // // Attach the handler
        // const resizers = document.querySelectorAll(".resizer");
        // // console.log("resizers", resizers);

        // for (resizer of resizers) {
        //   // console.log("resizer", resizer);
        //   resizer.addEventListener("mousedown", mouseDownHandler);
        // }
      }


      createDivider(left = null, right = null) { return { left, right } };

      createSegement(
        left = null,
        right = null,
        color = null,
        width = null
      ) {
        return {
          left, right, color, width
        }
      };
    }
    // const state = {
    //   dividers: [
    //     { left: null, right: null },
    //     { left: null, right: null },
    //   ],
    //   segments: [
    //     { color: "yellow", width: "33.333333333%", left: null, right: null },
    //     { color: "pink", width: "33.333333333%" },
    //     { color: "rgb(109, 220, 240)", width: "33.333333333%" },
    //   ],
    // };

    const bar = new BarMaker()
    // document.addEventListener("DOMContentLoaded", function () {
    //   // Query the element
    //   let resizer = null;
    //   let leftSide = null;
    //   let rightSide = null;

    //   // The current position of mouse
    //   let x = 0;
    //   let y = 0;
    //   let leftWidth = 0;
    //   let rightWidth = 0;
    //   let initialwidth = null;

    //   // Handle the mousedown event
    //   // that's triggered when user drags the resizer
    //   const mouseDownHandler = function (e) {
    //     resizer = e.target;
    //     leftSide = resizer.previousElementSibling;
    //     rightSide = resizer.nextElementSibling;
    //     // Get the current mouse position
    //     x = e.clientX;
    //     y = e.clientY;
    //     leftWidth = leftSide.getBoundingClientRect().width;
    //     rightWidth = rightSide.getBoundingClientRect().width;

    //     // console.log("mousedown sides", rightSide, leftSide);
    //     // console.log("mousedown target", e.target);

    //     // Attach the listeners to `document`
    //     document.addEventListener("mousemove", mouseMoveHandler);
    //     document.addEventListener("mouseup", mouseUpHandler);
    //   };

    //   const mouseMoveHandler = function (e) {
    //     // How far the mouse has been moved
    //     const dx = e.clientX - x;
    //     // console.log('dxxx', e.clientX, x, dx)
    //     const newLeftWidth =
    //       ((leftWidth + dx) * 100) /
    //       resizer.parentNode.getBoundingClientRect().width;
    //     leftSide.style.width = `${newLeftWidth}%`;

    //     const newRightWidth =
    //       ((rightWidth - dx + 2) * 100) / // +2 because of width of resizers
    //       resizer.parentNode.getBoundingClientRect().width;
    //     rightSide.style.width = `${newRightWidth}%`;

    //     if (rightSide.getBoundingClientRect().width <= 5) {
    //       // initialwidth && (initialwidth = leftWidth )
    //       // console.log("*******************");

    //       const rightOfRight =
    //         rightSide.nextElementSibling.nextElementSibling;
    //       const rightRightWidth = rightOfRight.getBoundingClientRect().width;

    //       const newRightRightWidth =
    //         ((rightRightWidth - dx + 2) * 100) / // +2 because of width of resizers
    //         resizer.parentNode.getBoundingClientRect().width;
    //       console.log("rightRightWidth, dx", rightRightWidth, dx);
    //       rightOfRight.style.width = `${newRightRightWidth}%`;
    //     }

    //     // console.log(
    //     //   "mousemove new widths",
    //     //   // leftSide.style.width,
    //     //   rightSide.getBoundingClientRect().width
    //     // );

    //     resizer.style.cursor = "col-resize";
    //     document.body.style.cursor = "col-resize";

    //     leftSide.style.userSelect = "none";
    //     leftSide.style.pointerEvents = "none";

    //     rightSide.style.userSelect = "none";
    //     rightSide.style.pointerEvents = "none";

    //     // console.log("mousedown", x, y, leftWidth);
    //   };

    //   const mouseUpHandler = function () {
    //     resizer.style.removeProperty("cursor");
    //     document.body.style.removeProperty("cursor");

    //     leftSide.style.removeProperty("user-select");
    //     leftSide.style.removeProperty("pointer-events");

    //     rightSide.style.removeProperty("user-select");
    //     rightSide.style.removeProperty("pointer-events");

    //     // Remove the handlers of `mousemove` and `mouseup`
    //     document.removeEventListener("mousemove", mouseMoveHandler);
    //     document.removeEventListener("mouseup", mouseUpHandler);
    //   };

    //   // Attach the handler
    //   const resizers = document.querySelectorAll(".resizer");
    //   // console.log("resizers", resizers);

    //   for (resizer of resizers) {
    //     // console.log("resizer", resizer);
    //     resizer.addEventListener("mousedown", mouseDownHandler);
    //   }
    // });
  </script>
</body>

</html>